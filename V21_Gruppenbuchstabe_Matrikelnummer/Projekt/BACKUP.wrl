#VRML V2.0 utf8

#############
## IMPORTS ##
#############

EXTERNPROTO Skifahrer [] "skifahrer.wrl"
EXTERNPROTO Baum [] "baum.wrl"
EXTERNPROTO LiftSaule [] "liftsaule.wrl"

##########################################
## DAY-NIGHT                            ##
## Handles Background and Light changes ##
##########################################

Group {
    children [
        DEF Day Background {
            topUrl "skybox/day/miramar_up.tga"
            bottomUrl "skybox/day/miramar_dn.tga"
            frontUrl "skybox/day/miramar_rt.tga"
            backUrl "skybox/day/miramar_lf.tga"
            leftUrl "skybox/day/miramar_bk.tga"
            rightUrl "skybox/day/miramar_ft.tga"
        }

        # DEF Night Background {
        #     topUrl "skybox/night/ypos.png"
        #     bottomUrl "skybox/night/yneg.png"
        #     frontUrl "skybox/night/zpos.png"
        #     backUrl "skybox/night/zneg.png"
        #     leftUrl "skybox/night/xneg.png"
        #     rightUrl "skybox/night/xpos.png"
        # }

        DEF DayLight DirectionalLight {
            ambientIntensity 0.2
            color 1 1 1
            global TRUE
            intensity 0.05
            on TRUE
            direction 0 -1 0
        }

        # TODO
        DEF DayNightButton SphereSensor {
            offset 0 1 0 0
            autoOffset TRUE
        }

        # TODO
        DEF LightButton SphereSensor {
            offset 0 1 0 0
            autoOffset TRUE
        }
    ]
}



Script {
    field SFBool buttonPressed FALSE
    field SFBool isDay TRUE
    
    field SFString topUrl "skybox/day/miramar_up.tga"
    field SFString bottomUrl "skybox/day/miramar_dn.tga"
    field SFString frontUrl "skybox/day/miramar_rt.tga"
    field SFString backUrl "skybox/day/miramar_lf.tga"
    field SFString leftUrl "skybox/day/miramar_bk.tga"
    field SFString rightUrl "skybox/day/miramar_ft.tga"

    field SFFloat ambientLightIntensity 0.5

    url "JavaScript:
        function buttonPressed(value, timestamp) {
            if(isDay && value) {
                // SET SKYBOX
                topUrl = 'skybox/night/ypos.png';
                bottomUrl = 'skybox/night/yneg.png';
                frontUrl = 'skybox/night/zpos.png';
                backUrl = 'skybox/night/zneg.png';
                leftUrl = 'skybox/night/xneg.png';
                rightUrl = 'skybox/night/xpos.png';

                // MAKE AMBIENT LIGHT DARKER
                ambientLightIntensity = 0.1;
            }
        }"
}


################
## VIEWPOINTS ##
################

DEF FrontView Viewpoint {
    description "Front View"
    position 0 125 400
    orientation 0 0 1 0}
DEF BirdEyeView Transform {
    rotation 0 1 0 1.5707 # Ry(90)
    children [
        Viewpoint {
            description "Bird Eye View"
            position 250 600 0
            orientation 0 1 1 3.1415
        }
    ]}
DEF SkiHouseView Viewpoint {
    description "Ski House View"
    position -130 30 10
    orientation 1 -1.5 0 0.4}
DEF TopHillView Viewpoint {
    description "Top of Hill View"
    position 0 450 -600
    orientation 0 2.5 1 3.14}
DEF PoleView Transform {
    translation -150 250 -400
    children [
        Transform {
            rotation 0 1 0 -2.094 # Ry(-120)
            children [
                Transform {
                    rotation 1 0 0 -0.52 # Rx(-30)
                    children [
                        Viewpoint {
                            description "Top Pole View"
                            position 0 0 0
                        }
                    ]
                }
            ]
        }
    ]}
DEF OverviewView Transform {
    translation 650 350 140
    children [
        Transform {
            rotation 0 1 0 1.1
            children [
                Transform {
                    rotation 1 0 0 -0.4
                    children [
                        Viewpoint {
                            description "Overview View"
                            position 0 0 0
                        }
                    ]
                }
            ]
        }
    ]}

###########
## WORLD ##
###########

DEF Ursprung Shape {
    geometry Sphere {
        radius .1
        solid TRUE
    }
    appearance Appearance {
        material Material {
            diffuseColor 1 1 1
        }
    }}
DEF Skifahrer Transform {
    translation 0 200 -401
    children [
        DEF Skifahrer1RotationX Transform {
            rotation 0 0 0 0 # Rx(45)
            children [
                DEF Skifahrer1 Transform {
                    translation 0 0 0
                    children [
                        DEF Skifahrer1RotationY Transform {
                            rotation 0 0 0 0
                            children [
                                Skifahrer { farbe .5 0 0 name "Red" }
                            ]
                        }
                    ]
                }
            ]
        }
        Transform {
            rotation 1 0 0 0.78 # Rx(45)
            children [
                DEF Skifahrer2 Transform {
                    children [
                        Skifahrer { farbe 0 .5 0 name "Green" }
                    ]
                }
                DEF Skifahrer3 Transform {
                    translation 25 0 0
                    children [
                        Skifahrer { farbe 0 0 .5 name "Blue" }
                    ]
                }
            ]
        }
    ]}
DEF Bodenhang Transform {
    children [
        ###############
        # OBERFLÄCHEN #
        ###############
        DEF FlatBox Transform {
            translation 0 -5 0
            children [
                Shape {
                    geometry Box {
                        size 400 10 420
                        solid TRUE
                    }
                    appearance Appearance {
                        material Material {
                            diffuseColor 1 1 1
                        }
                    }
                }
            ]}
        DEF InclinedBox Transform {
            translation 0 137 -345
            children [
                DEF InclineSurface Transform {
                    rotation 1 0 0 0.78
                    children [
                        Shape {
                            geometry Box {
                                size 400 10 400
                                solid TRUE
                            }
                            appearance Appearance {
                                material Material {
                                    diffuseColor 1 1 1
                                }
                            }
                        }
                    ]
                }
            ]}
        
        #########
        # BÄUME #
        #########
        DEF Baum1 Transform {
            translation 150 10 0
            children [
                Baum {}
            ]}
        DEF Baum2 Transform {
            translation 140 10 100
            children [
                Baum {}
            ]}
        DEF Baum3 Transform {
            translation 145 10 -100
            children [
                Baum {}
            ]}
        DEF Baum4 Transform {
            translation 131 20 -215
            children [
                Baum {}
            ]}
        DEF Baum5 Transform {
            translation 135 105 -300
            children [
                Baum {}
            ]}
        DEF Baum6 Transform {
            translation 40 10 90
            children [
                Baum {}
            ]}
        DEF Baum7 Transform {
            translation 10 10 150
            children [
                Baum {}
            ]}
        DEF Baum8 Transform {
            translation -50 10 130
            children [
                Baum {}
            ]}
        DEF Baum9 Transform {
            translation 75 10 160
            children [
                Baum {}
            ]}
        DEF Baum10 Transform {
            translation 150 10 40
            children [
                Baum {}
            ]}
    ]}
DEF Haus Transform {
    translation -130 10 10
    children [
        Shape {
            geometry Box {
                size 75 20 125
                solid TRUE
            }
            appearance Appearance {
                material Material {
                    diffuseColor .5 .5 .2
                }
            }
        }
    ]}
DEF LiftSaulen Transform {
    translation -150 25 -200
    children [
        DEF Saule1 Transform {
            children [
                LiftSaule {}                      
            ]}
        DEF Saule2 Transform {
            translation 0 45 -50 # TODO 
            children [
                LiftSaule {}
            ]}
        DEF Saule3 Transform {
            translation 0 95 -100 # TODO
            children [
                LiftSaule {}
            ]}
        DEF Saule4 Transform {
            translation 0 145 -150 # TODO
            children [
                LiftSaule {}
            ]}
        DEF Saule5 Transform {
            translation 0 195 -200 # TODO
            children [
                LiftSaule {}
            ]}
    ]}
DEF SkiLeine Transform {
    translation 0 0 -200
    children [
        Transform {
            children [
                Shape {
                    geometry Cylinder {
                        top FALSE
                        bottom FALSE
                        height 100
                        radius 1
                        side TRUE
                        solid TRUE
                    }
                }
            ]
        }
    ]}

###############
## ANIMATION ##
###############

DEF skiTimer TimeSensor {
    cycleInterval 30
    enabled TRUE
    loop TRUE
}

DEF skiXOriInter OrientationInterpolator {
    key [
        0.00 # START BERG RUNTER
        0.30 # ENDE  BERG RUNTER
        0.30 # START GERADE 
        0.60 # ENDE GERADE
        0.60 # START BERG HOCH
        0.99 # ENDE BERG HOCH
    ]
    keyValue [
        1 0 0 0.78
        1 0 0 0.78
        1 0 0 0
        1 0 0 0
        1 0 0 0.78
        1 0 0 0.78
    ]
}

DEF skiYOriInter OrientationInterpolator {
    key [
        # BERG RUNTER
        0.00 
        0.02 # Rotation ohne bewegung
        0.06 # Vor Punkt 1
        0.08 # Punkt 1
        0.135 # Vor Punkt 2
        0.15 # Punkt 2
        0.195 # Vor Punkt 3
        0.21 # Punkt 3
        0.24 # Vor Punkt 4
        0.26 # Punkt 4
        0.30 # Endstrecke
        0.30

        # GERADE
        0.30 # Zum Haus fahren
        0.35 # Vor Haus (warten)
        0.40 # ab hier die Drehung bis 0.45
        0.45 # Vor Haus (warten)
        0.50 # Zum Lift
        0.60 # Vor Lift

        # BERG HOCH
        0.60 # start fahrt gerade aus
        0.90 # ende fahrt gerade aus
        0.92 # start fahrt zum startpunkt
        0.98 # ende fahrt zum startpunkt
        1    # ende rotation auf 0 bringen
    ]
    keyValue [
        # BERG RUNTER
        0 1 0 0
        0 1 0 -0.90 # Rotation ohne bewegung
        0 1 0 -0.90 # Vor Punkt 1
        0 1 0  1    # Punkt 1
        0 1 0  1    # Vor Punkt 2
        0 1 0 -1.25 # Punkt 2
        0 1 0 -1.25 # Vor Punkt 3
        0 1 0  0.78 # Punkt 3
        0 1 0  0.78 # Vor Punkt 4
        0 1 0  0    # Punkt 4
        0 1 0  0    # Endstrecke
        0 1 0  0

        # GERADE
        0 1 0  0 # Zum Haus fahren
        0 1 0  0 # Vor Haus (warten)
        0 1 0  0 # ab hier die Drehung bis 0.45
        0 1 0  0 # Vor Haus (warten)
        0 1 0  0 # Zum Lift
        0 1 0  0 # Vor Lift
        
        # BERG HOCH
        #0.60 # start fahrt gerade aus
        #0.90 # ende fahrt gerade aus
        #0.92 # start fahrt zum startpunkt
        #0.98 # ende fahrt zum startpunkt
        #1    # ende rotation auf 0 bringen


        #0 1 0 3.14
        #0 1 0 3.14 # ende der fahrt gerade aus
        #0 1 0 1.52
        # ende der fahrt gerade aus
        # TODO
        # ENDE BERG HOCH
    ]
}

DEF skiPosInter PositionInterpolator {
    key [
        # BERG RUNTER
        0.00 
        0.02 # Rotation ohne bewegung
        0.08 # Punkt 1
        0.15 # Punkt 2
        0.21 # Punkt 3
        0.26 # Punkt 4
        0.30 # Endstrecke
        0.30

        # GERADE
        0.30
        # TODO
        0.60

        # BERG HOCH
        0.60
        0.90 # ende der fahrt gerade aus
        # TODO
        1
    ]
    keyValue [
        -25 0 0         # START BERG RUNTER
            -25 0 0     # Rotation ohne bewegung
           -100 0 50   # Punkt 1
             75 0 100  # Punkt 2
           -100 0 150  # Punkt 3
            -25 0 200  # Punkt 4
            -25 0 280  #Endstrecke
        -25 0 282       # ENDE  BERG RUNTER
        -25 -200 203    # START GERADE
            # TODO
        -25 -200 201    # ENDE  GERADE
        -140 0 282      # START BERG HOCH
            -140 0 0    # ende der fahrt gerade aus
            #TODO
        -25 0 0         # ENDE  BERG HOCH
    ]
    
}

ROUTE skiTimer.fraction_changed TO skiYOriInter.set_fraction
ROUTE skiTimer.fraction_changed TO skiXOriInter.set_fraction
ROUTE skiTimer.fraction_changed TO skiPosInter.set_fraction

ROUTE skiYOriInter.value_changed TO Skifahrer1RotationY.set_rotation
ROUTE skiXOriInter.value_changed TO Skifahrer1RotationX.set_rotation
ROUTE skiPosInter.value_changed TO Skifahrer1.set_translation



















